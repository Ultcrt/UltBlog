---
title: 纯方向光在路径追踪中的处理方法
date: 2024-02-20T06:07:48.916Z
last_modified_at: 2024-02-20T06:07:48.917Z
excerpt: 本文探讨了纯方向光在路径追踪中的处理方法，包括对于渲染方程的积分项的一些思考
categories:
  - 图形学
tags:
  - 数学
  - 路径追踪
header:
  overlay_image: https://picsum.photos/1920/640
  caption: "来源: [**Lorem Picsum**](https://picsum.photos/)"
  teaser: https://ultcrt.github.io/UltBlog/assets/images/site/default-teaser.png
---
这里将纯方向光源定义为来自无限远处、面积无限大、且发出的光线方向只有唯一方向的光源。例如日光。

常见的路径追踪算法中，为了避免随机采样导致小光源难以被射线击中的问题，可以使用直接光源采样（Direct/explicit light sampling）方法。

这种方法将一个点的Radiance分类讨论为两种：
1. 直接光照，对光源表面进行积分，直接计算出光源对Radiance的贡献
2. 间接光照，对立体角进行积分，递归的计算出非光源对Radiance的贡献

通过这种方式，即可避免小光源难以被命中的问题。

但是这种方式只适用于面积有限的非方向光源，而对于纯方向光源来说，无法通过对光源表面进行积分来进行计算（因为正如上文所说，纯方向光源是无限大且方向唯一的）。

为了求解纯方向光源的直接光照，我们先来看一下渲染方程的定义：
$$
L_r(x, \omega_o)=\int_{\Omega}f_r(x, \omega_i, \omega_o)L_i(x, \omega_i)(\omega_i\cdot n)d\omega_i
$$

公式中各项的定义与[Wiki](https://en.wikipedia.org/wiki/Rendering_equation#:~:text=In%20computer%20graphics%2C%20the%20rendering,by%20David%20Immel%20et%20al.)一致（本文省略了波长、时间等无关变量）。

其中，BRDF项的定义为：
$$
f_r(x, \omega_i, \omega_o) = \frac {dL_r(x, \omega_o)} {dE_i(\omega_i)} = \frac {dL_r(x, \omega_o)} {L_i(x, \omega_i)(\omega_i\cdot n)d\omega_i}
$$

需要注意，$dL_r(x, \omega_o)$的定义为$p$点在$\omega_o$方向的Radiance在$\omega_i$上的微分，因此其微元同样为$d\omega_i$。

因此，最终

















































































